(this["webpackJsonpimg-pdf"]=this["webpackJsonpimg-pdf"]||[]).push([[0],{126:function(e,t,r){},153:function(e,t,r){},161:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(54),c=r(46),i=r(113),s=(r(126),r(171)),l=r(174),u=r(59),d=r(19),b=r.n(d),h=r(26),p=r(22),j=r(36),f=r(164),m=r(165),g=r(166),x=r(173),v=r(167),O=r(168),w=r(169),y=r(62),k=r(49),C=r(88),N=r.n(C),B=r(89),P="images";function S(){return(S=Object(h.a)(b.a.mark((function e(t){var r,n,a,o,c,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new URL(t.trim()),a=["/eBook.html","/mEBook.html"].map((function(e){return e.toLowerCase()})),["www.myeschoolhome.com","myeschoolhome.com"].map((function(e){return e.toLowerCase()})).includes(n.host.toLowerCase())&&a.includes(n.pathname.toLowerCase())){e.next=5;break}throw new Error("Not supported book url");case 5:if(o=n.searchParams.get("name")){e.next=8;break}throw new Error("Missing book name");case 8:return e.next=10,N.a.post("https://cors.ali-yusuf.com/",{ebookNewName:o,userId:null},{headers:{"Content-Type":"application/json; charset=UTF-8",Authorization:"Bearer null"},params:{url:"https://www.myeschoolhome.com/library/webservice/ebooks/getEbookConfig"}});case 10:c=e.sent,e.prev=11,i=JSON.parse(c.data.bookConfig),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(11),new Error("Can't parse response data.");case 18:return e.abrupt("return",Object(k.a)(Object(k.a)({},i),{},{URL:n,accessibleBook:!!(null===(r=c.data)||void 0===r?void 0:r.accessibleBook)}));case 19:case"end":return e.stop()}}),e,null,[[11,15]])})))).apply(this,arguments)}function L(e){return function(t){return"https://cors.ali-yusuf.com/?url=".concat(e.URL.origin).concat(e.largePath).concat(t,".jpg")}}function E(e,t,r){return R.apply(this,arguments)}function R(){return(R=Object(h.a)(b.a.mark((function e(t,r,n){var a,o,c,i,s,l,u,d,p;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=r.firstPage,o=r.lastPage,c=0,2,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return c+=e||1,Math.floor(c/2)},s=L(t),l=[],u=a;u<=o;u++)l.push(s(u));if(d=[],!("caches"in window)){e.next=13;break}return e.next=11,caches.open(P).then(function(){var e=Object(h.a)(b.a.mark((function e(t){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addAll(l);case 2:null===n||void 0===n||n(i(l.length)),r=l.map((function(e,r){return t.match(e).then((function(t){if(!t)throw new Error("Missing image, Url: ".concat(e));return null===n||void 0===n||n(i()),new Promise((function(e,n){t.arrayBuffer().then((function(t){e({data:t,sort:r})})).catch(n)}))}))})),d.push.apply(d,Object(y.a)(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:e.next=15;break;case 13:p=l.map((function(e,t){return new Promise((function(r,a){var o=document.createElement("canvas"),c=new Image;c.src=e,c.onload=function(){null===n||void 0===n||n(i()),o.width=c.naturalWidth,o.height=c.naturalHeight;var s=o.getContext("2d");null===s||void 0===s||s.drawImage(c,0,0),o.toBlob((function(c){c?c.arrayBuffer().then((function(e){null===n||void 0===n||n(i()),r({data:e,sort:t})})).catch(a):a(new Error("Empty image blob, Url: ".concat(e))),o.remove()}),"image/jpeg")},c.crossOrigin="anonymous",c.onerror=function(e){o.remove(),a(e)}}))})),d.push.apply(d,Object(y.a)(p));case 15:return e.abrupt("return",Promise.all(d).then((function(e){return e.sort((function(e,t){return e.sort>t.sort?1:-1})).map((function(e){return e.data}))})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t){return W.apply(this,arguments)}function W(){return(W=Object(h.a)(b.a.mark((function e(t,r){var n,a,o,c,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,2,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return n+=e||1,Math.floor(n/2)},e.next=5,B.PDFDocument.create();case 5:return o=e.sent,c=t.map((function(e,t){return new Promise((function(r,n){o.embedJpg(e).then((function(e){r({data:e,sort:t})})).catch(n)}))})),e.next=9,Promise.all(c);case 9:return i=e.sent.sort((function(e,t){return e.sort>t.sort?1:-1})).map((function(e){return e.data})),null===r||void 0===r||r(a(i.length)),i.forEach((function(e){o.addPage([e.width,e.height]).drawImage(e,{x:0,y:0})})),null===r||void 0===r||r(a(i.length)),e.abrupt("return",o.save());case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){var r=URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),n.remove(),setTimeout((function(){URL.revokeObjectURL(r)}),0)}function A(){return U.apply(this,arguments)}function U(){return(U=Object(h.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("caches"in window)){e.next=3;break}return e.next=3,caches.delete(P);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r(153);var I=r(6);var T=function(){var e,t=Object(n.useState)("https://www.myeschoolhome.com/eBook.html?name=53b9097825a663d6df34332149405b8e88a52c39393aaf4c53dcd71ad779063f#page/4"),r=Object(p.a)(t,2),o=r[0],i=r[1],s=Object(n.useState)(void 0),l=Object(p.a)(s,2),d=l[0],y=l[1],k=Object(n.useState)("init"),C=Object(p.a)(k,2),N=C[0],B=C[1],P=Object(n.useState)(0),R=Object(p.a)(P,2),W=R[0],A=R[1],U=Object(n.useState)(void 0),T=Object(p.a)(U,2),M=T[0],z=T[1],J=Object(n.useState)(1),Q=Object(p.a)(J,2),V=Q[0],H=Q[1],_=Object(n.useState)(1),G=Object(p.a)(_,2),q=G[0],K=G[1],X=a.a.createRef(),Y=a.a.createRef(),Z=Object(c.useQuery)(["book","info",o],(function(){return function(e){return S.apply(this,arguments)}(o)}),{enabled:!1,refetchOnWindowFocus:!1,refetchInterval:!1,retry:1,retryDelay:0,onSuccess:function(e){z(e),H((null===e||void 0===e?void 0:e.startPage)||1),K((null===e||void 0===e?void 0:e.totalPageCount)||1),e.accessibleBook||y("Invalid book url")}}),$=function(){var e=Object(h.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),A(0),y(void 0),z(void 0),B("init"),H(1),K(1),e.next=9,Z.refetch();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ee=function(e){return function(t){var r=parseInt(t.target.value,10);e(Number.isNaN(r)?-1:r)}};Object(n.useEffect)((function(){if(M&&M.accessibleBook){var e,t,r,n,a=!1;if(V<=0||V>M.totalPageCount)null===(e=X.current)||void 0===e||e.classList.add("errored"),a=!0;else null===(t=X.current)||void 0===t||t.classList.remove("errored");if(q<V||q>M.totalPageCount)null===(r=Y.current)||void 0===r||r.classList.add("errored"),a=!0;else null===(n=Y.current)||void 0===n||n.classList.remove("errored");y(a?"Wrong pages rage inputs":void 0)}}),[M,X,V,Y,q]);var te=function(){var e=Object(h.a)(b.a.mark((function e(t){var r,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),M&&M.accessibleBook){e.next=3;break}return e.abrupt("return");case 3:if(!(V<=0||V>M.totalPageCount)){e.next=5;break}return e.abrupt("return");case 5:if(!(q<V||q>M.totalPageCount)){e.next=7;break}return e.abrupt("return");case 7:return y(void 0),A(0),B("loading"),e.prev=10,e.next=13,E(M,{firstPage:V,lastPage:q},(function(e){A(.8*e)}));case 13:return r=e.sent,e.next=16,F(r,(function(e){var t=.2*e;A((function(e){return e+t}))}));case 16:n=e.sent,D(new Blob([n],{type:"application/pdf"}),M.title),B("finish"),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(10),"string"===typeof e.t0?y(e.t0):e.t0 instanceof Error?y(e.t0.message):y(e.t0);case 25:case"end":return e.stop()}}),e,null,[[10,22]])})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)("article",{className:"Box-row",children:[Object(I.jsx)("label",{htmlFor:"repository_description",children:"Book link"}),Object(I.jsxs)("div",{className:"input-group",children:[Object(I.jsx)("input",{className:"form-control",type:"url",placeholder:"https://www.myeschoolhome.com/mEBook.html?name=xxxxxx",value:o,onChange:function(e){return i(e.target.value)},"aria-label":"link"}),Object(I.jsx)("span",{className:"input-group-button",children:Object(I.jsx)("button",{className:"btn btn-primary",type:"button","aria-label":"Copy to clipboard",disabled:Z.isLoading,onClick:$,children:Z.isLoading?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(f.a,{size:"small",sx:{verticalAlign:"text-bottom"}})," ",Object(I.jsxs)("span",{className:"text-light",children:["Checking",Object(I.jsx)("span",{className:"AnimatedEllipsis"})]})]}):Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(j.b,{})," ",Object(I.jsx)("span",{className:"text-light",children:" Check"})]})})})]}),(Z.isError||d)&&Object(I.jsx)(m.a,{my:3,variant:"danger",children:d||(null===(e=Z.error)||void 0===e?void 0:e.message)}),M&&M.accessibleBook&&Object(I.jsxs)(u.a,{borderWidth:"1px",borderStyle:"solid",borderColor:"border.default",borderRadius:2,bg:"canvas.subtle",mt:3,p:3,children:[Object(I.jsxs)(u.a,{display:"grid",gridTemplateColumns:"1fr 1fr",children:[Object(I.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:"Title"}),Object(I.jsx)(u.a,{borderColor:"border.default",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:null===M||void 0===M?void 0:M.title}),Object(I.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:"Cover page"}),Object(I.jsx)(u.a,{borderColor:"border.default",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:Object(I.jsx)("img",{alt:"cover page",width:"200",src:L(M)(1)})}),Object(I.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",p:2,children:"Pages"}),Object(I.jsx)(u.a,{p:2,children:null===M||void 0===M?void 0:M.totalPageCount})]}),Object(I.jsxs)(u.a,{borderColor:"border.default",borderTopWidth:1,borderTopStyle:"solid",p:2,children:[Object(I.jsx)(g.a,{fontSize:2,mb:2,children:"Range"}),Object(I.jsxs)("div",{className:"form-group",ref:X,children:[Object(I.jsx)("div",{className:"form-group-header",children:Object(I.jsx)("label",{htmlFor:"start-page",children:"Start page"})}),Object(I.jsx)("div",{className:"form-group-body",children:Object(I.jsx)(x.a,{className:"form-control",type:"number",id:"start-page",icon:j.d,placeholder:M.totalPageCount,"aria-label":"First page","aria-describedby":"start-page-input-validation",defaultValue:V,onChange:ee(H),min:1,max:M.totalPageCount})}),Object(I.jsxs)("p",{className:"note error",id:"start-page-input-validation",children:["Start page must be between 1 and ",M.totalPageCount]})]}),Object(I.jsxs)("div",{className:"form-group",ref:Y,children:[Object(I.jsx)("div",{className:"form-group-header",children:Object(I.jsx)("label",{htmlFor:"last-page",children:"Last page"})}),Object(I.jsx)("div",{className:"form-group-body",children:Object(I.jsx)(x.a,{className:"form-control",type:"number",id:"last-page",icon:j.e,placeholder:"1","aria-label":"First page","aria-describedby":"last-page-input-validation",defaultValue:q,onChange:ee(K)})}),Object(I.jsxs)("p",{className:"note error",id:"last-page-input-validation",children:["Last page must be between ",V," and"," ",M.totalPageCount]})]})]}),Object(I.jsxs)(u.a,{pt:3,textAlign:"center",children:[Object(I.jsx)(v.a,{disabled:!!d,onClick:te,children:"loading"!==N?Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(j.a,{})," Download"]}):Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(f.a,{size:"small",sx:{verticalAlign:"text-bottom"}})," ",Object(I.jsxs)("span",{className:"text-light",children:["Generating pdf file",Object(I.jsx)("span",{className:"AnimatedEllipsis"})]})]})}),Object(I.jsx)(O.a,{onClick:function(e){e.preventDefault(),i(""),B("init"),A(0),z(void 0),y(void 0)},ml:3,children:"Reset"})]}),"init"!==N&&Object(I.jsx)(u.a,{pt:3,children:Object(I.jsx)(w.a,{className:"progress anim-grow-x",progress:W})})]})]})},M=r(170),z=r(172),J=r(110);function Q(){var e=Object(n.useState)(!1),t=Object(p.a)(e,2),r=t[0],o=t[1],c=a.a.useRef(null),i=function(){var e=Object(h.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,A();case 3:window.location.reload(),o(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsxs)(M.a,{ref:c,onClick:function(){return o(!0)},children:[Object(I.jsx)(j.c,{})," Clear Cache"]}),Object(I.jsxs)(z.a,{isOpen:r,returnFocusRef:c,onDismiss:function(){return o(!1)},"aria-labelledby":"label",children:[Object(I.jsxs)(z.a.Header,{children:[Object(I.jsx)(j.f,{})," Attention"]}),Object(I.jsxs)(u.a,{p:3,children:[Object(I.jsx)(J.a,{id:"label",fontFamily:"sans-serif",children:"Are you sure you'd like to delete cached images?"}),Object(I.jsxs)(u.a,{display:"flex",mt:3,justifyContent:"flex-end",children:[Object(I.jsx)(O.a,{onClick:function(){return o(!1)},sx:{mr:1},children:"Cancel"}),Object(I.jsx)(M.a,{onClick:i,children:"Delete"})]})]})]})]})}var V=function(){return Object(I.jsxs)("div",{className:"position-relative container-lg p-responsive pt-6",children:[Object(I.jsx)(u.a,{children:Object(I.jsx)(T,{})}),Object(I.jsx)(u.a,{mt:5,children:Object(I.jsx)(Q,{})})]})};var H=function(){return Object(I.jsx)("div",{className:"footer container-lg width-full p-responsive",children:Object(I.jsx)("div",{className:"d-flex flex-justify-center pb-6",children:Object(I.jsx)("span",{className:"f6 color-fg-muted"})})})};var _=function(){return Object(I.jsx)("div",{className:"color-bg-subtle border-bottom",children:Object(I.jsxs)("div",{className:"container-lg p-responsive text-center py-6",children:[Object(I.jsx)("h1",{className:"h1",children:"Download Book"}),Object(I.jsxs)("p",{className:"f4 color-fg-muted col-md-6 mx-auto",children:["Version v","0.2.2"]})]})})};var G=function(){return Object(I.jsx)(s.a,{colorMode:"auto",dayScheme:"light",nightScheme:"dark_dimmed",children:Object(I.jsx)(l.a,{children:Object(I.jsxs)("div",{className:"application-main",children:[Object(I.jsx)(_,{}),Object(I.jsx)(V,{}),Object(I.jsx)(H,{})]})})})},q=function(e){e&&"function"===typeof e&&r.e(3).then(r.bind(null,175)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;r(e),n(e),a(e),o(e),c(e)}))};var K=new c.QueryClient;Object(o.render)(Object(I.jsx)(n.StrictMode,{children:Object(I.jsx)(c.QueryClientProvider,{client:K,children:Object(I.jsx)(i.a,{children:Object(I.jsx)(G,{})})})}),document.getElementById("root")),function(){var e=document.getElementsByClassName("js-site-favicon"),t=!1;function r(r){if(t!==r)for(var n=(t=r)?"favicon.":"favicon-dark.",a=t?"favicon-dark.":"favicon.",o=0;o<e.length;o++)e[o].href=e[o].href.replace(n,a)}r(window.matchMedia("(prefers-color-scheme: dark)").matches),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){return r(e.matches)}))}(),q()}},[[161,1,2]]]);
//# sourceMappingURL=main.13881887.chunk.js.map