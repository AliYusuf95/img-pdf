{"version":3,"sources":["app/components/download-form/service.ts","app/components/download-form/DownloadForm.tsx","app/components/container/ClearCache.tsx","app/components/container/Container.tsx","app/components/footer/Footer.tsx","app/components/header/Header.tsx","app/App.tsx","reportWebVitals.ts","index.tsx","updateFavIcon.ts"],"names":["CACHE_KEY","getBookInfo","stringUrl","a","url","URL","trim","allowedPaths","map","s","toLowerCase","includes","host","pathname","Error","bookId","searchParams","get","axios","post","ebookNewName","userId","headers","Authorization","params","response","data","JSON","parse","bookConfig","getImageURL","id","origin","largePath","getBookImages","callback","currentProgress","getProgress","progress","Math","floor","imageURLGen","images","i","startPage","totalPageCount","push","result","window","caches","open","then","cache","addAll","length","promises","index","match","Promise","resolve","reject","arrayBuffer","arr","sort","catch","src","canvas","document","createElement","img","Image","onload","width","naturalWidth","height","naturalHeight","ctx","getContext","drawImage","toBlob","b","remove","crossOrigin","onerror","e","all","res","item","createPDFFromImages","PDFDocument","create","pdfDoc","image","embedJpg","pdfImage","pdfImages","forEach","addPage","x","y","save","downloadFileFromBlob","blob","fileName","fileUrl","createObjectURL","setAttribute","style","visibility","body","appendChild","click","setTimeout","revokeObjectURL","clearCache","delete","DownloadForm","useState","bookUrl","setBookUrl","undefined","error","setError","progressState","setProgressState","setProgress","bookInfo","setBookInfo","bookInfoQuery","useQuery","enabled","refetchOnWindowFocus","refetchInterval","retry","retryDelay","onSuccess","onClickBookInfo","evt","preventDefault","refetch","onClickDownload","step","current","prevState","pdf","Blob","type","title","className","htmlFor","placeholder","value","onChange","target","aria-label","disabled","isLoading","onClick","Spinner","size","sx","verticalAlign","isError","Flash","my","variant","message","Box","borderWidth","borderStyle","borderColor","borderRadius","bg","mt","p","display","gridTemplateColumns","fontWeight","borderRightWidth","borderRightStyle","borderBottomWidth","borderBottomStyle","alt","pt","textAlign","ButtonPrimary","Button","ml","ProgressBar","ClearCache","isOpen","setIsOpen","returnFocusRef","React","useRef","onClickClearCache","location","reload","ButtonDanger","ref","Dialog","onDismiss","aria-labelledby","Header","Text","fontFamily","justifyContent","mr","Container","Footer","process","App","ThemeProvider","colorMode","dayScheme","nightScheme","BaseStyles","reportWebVitals","onPerfEntry","getCLS","getFID","getFCP","getLCP","getTTFB","queryClient","QueryClient","render","client","getElementById","faviconTags","getElementsByClassName","lastCheck","changeFavIcon","isDark","search","replace","href","matchMedia","matches","addEventListener","updateFavIcon"],"mappings":"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","file":"static/js/main.3873d86f.chunk.js","sourcesContent":["import axios from 'axios';\nimport { PDFDocument } from 'pdf-lib';\nimport type { PDFImage } from 'pdf-lib';\n\nconst CACHE_KEY = 'images';\n\ninterface BookInfoResponse {\n  accessibleBook: boolean;\n  bookConfig: string;\n}\n\nexport interface BookConfig {\n  URL: URL;\n  HomeURL: string;\n  RightToLeft: string;\n  appLogoIcon: string;\n  backGroundImgURL: string;\n  largePath: string;\n  normalPath: string;\n  startPage: number;\n  thumbPath: string;\n  title: string;\n  totalPageCount: number;\n}\n\nexport async function getBookInfo(stringUrl: string): Promise<BookConfig> {\n  const url = new URL(stringUrl.trim());\n  const allowedPaths = ['/eBook.html', '/mEBook.html'].map((s) =>\n    s.toLowerCase(),\n  );\n  const allowedHosts = ['www.myeschoolhome.com', 'myeschoolhome.com'].map((s) =>\n    s.toLowerCase(),\n  );\n  if (\n    !allowedHosts.includes(url.host.toLowerCase()) ||\n    !allowedPaths.includes(url.pathname.toLowerCase())\n  ) {\n    throw new Error('Not supported book url');\n  }\n  const bookId = url.searchParams.get('name');\n  if (!bookId) {\n    throw new Error('Missing book name');\n  }\n  const response = await axios.post<BookInfoResponse>(\n    'https://cors.ali-yusuf.com/',\n    { ebookNewName: bookId, userId: null },\n    {\n      headers: {\n        'Content-Type': 'application/json; charset=UTF-8',\n        Authorization: 'Bearer null',\n      },\n      params: {\n        url: 'https://www.myeschoolhome.com/library/webservice/ebooks/getEbookConfig',\n      },\n    },\n  );\n  let data: BookConfig;\n  try {\n    data = JSON.parse(response.data.bookConfig);\n  } catch (e: unknown) {\n    throw new Error(\"Can't parse response data.\");\n  }\n  return { ...data, URL: url };\n}\n\nexport function getImageURL(bookConfig: BookConfig) {\n  return (id: number): string =>\n    `https://cors.ali-yusuf.com/?url=${bookConfig.URL.origin}${bookConfig.largePath}${id}.jpg`;\n}\n\nexport async function getBookImages(\n  bookConfig: BookConfig,\n  callback?: (progress: number) => void,\n): Promise<ArrayBuffer[]> {\n  let currentProgress = 0;\n  const processSteps = 2;\n  const getProgress = (progress = 0) => {\n    currentProgress += progress || 1;\n    return Math.floor(currentProgress / processSteps);\n  };\n\n  const imageURLGen = getImageURL(bookConfig);\n  const images: string[] = [];\n  for (let i = bookConfig.startPage; i <= bookConfig.totalPageCount; i++) {\n    images.push(imageURLGen(i));\n  }\n\n  const result: Promise<{ data: ArrayBuffer; sort: number }>[] = [];\n  if ('caches' in window) {\n    await caches.open(CACHE_KEY).then(async (cache) => {\n      await cache.addAll(images);\n      callback?.(getProgress(images.length));\n      const promises = images.map((url, index) =>\n        cache.match(url).then((data) => {\n          if (!data) {\n            throw new Error(`Missing image, Url: ${url}`);\n          }\n          callback?.(getProgress());\n          return new Promise<{ data: ArrayBuffer; sort: number }>(\n            (resolve, reject) => {\n              data\n                .arrayBuffer()\n                .then((arr) => {\n                  resolve({ data: arr, sort: index });\n                })\n                .catch(reject);\n            },\n          );\n        }),\n      );\n      result.push(...promises);\n    });\n  } else {\n    const promises = images.map((src, index) => {\n      return new Promise<{ data: ArrayBuffer; sort: number }>(\n        (resolve, reject) => {\n          const canvas = document.createElement('canvas');\n          const img = new Image();\n          img.src = src;\n          img.onload = () => {\n            callback?.(getProgress());\n            canvas.width = img.naturalWidth;\n            canvas.height = img.naturalHeight;\n            const ctx = canvas.getContext('2d');\n            ctx?.drawImage(img, 0, 0);\n            canvas.toBlob((b) => {\n              if (b) {\n                b.arrayBuffer()\n                  .then((arr) => {\n                    callback?.(getProgress());\n                    resolve({ data: arr, sort: index });\n                  })\n                  .catch(reject);\n              } else {\n                reject(new Error(`Empty image blob, Url: ${src}`));\n              }\n              canvas.remove();\n            }, 'image/jpeg');\n          };\n          img.crossOrigin = 'anonymous';\n          img.onerror = (e) => {\n            canvas.remove();\n            reject(e);\n          };\n        },\n      );\n    });\n    result.push(...promises);\n  }\n\n  return Promise.all(result).then((res) =>\n    res.sort((a, b) => (a.sort > b.sort ? 1 : -1)).map((item) => item.data),\n  );\n}\n\nexport async function createPDFFromImages(\n  images: ArrayBuffer[],\n  callback?: (progress: number) => void,\n): Promise<Uint8Array> {\n  let currentProgress = 0;\n  const processSteps = 2;\n  const getProgress = (progress = 0) => {\n    currentProgress += progress || 1;\n    return Math.floor(currentProgress / processSteps);\n  };\n  const pdfDoc = await PDFDocument.create();\n  const promises = images.map((image, index) => {\n    return new Promise<{ data: PDFImage; sort: number }>((resolve, reject) => {\n      pdfDoc\n        .embedJpg(image)\n        .then((pdfImage) => {\n          resolve({ data: pdfImage, sort: index });\n        })\n        .catch(reject);\n    });\n  });\n  const pdfImages = (await Promise.all(promises))\n    .sort((a, b) => (a.sort > b.sort ? 1 : -1))\n    .map((item) => item.data);\n  callback?.(getProgress(pdfImages.length));\n  pdfImages.forEach((image) => {\n    const page = pdfDoc.addPage([image.width, image.height]);\n    page.drawImage(image, {\n      x: 0,\n      y: 0,\n    });\n  });\n  callback?.(getProgress(pdfImages.length));\n  return pdfDoc.save();\n}\n\nexport function downloadFileFromBlob(blob: Blob, fileName: string): void {\n  const fileUrl = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.setAttribute('href', fileUrl);\n  a.setAttribute('download', fileName);\n  a.style.visibility = 'hidden';\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  setTimeout(() => {\n    URL.revokeObjectURL(fileUrl);\n  }, 0);\n}\n\nexport async function clearCache(): Promise<void> {\n  if ('caches' in window) {\n    await caches.delete(CACHE_KEY);\n  }\n}\n","import React, { useState } from 'react';\nimport type { MouseEvent } from 'react';\nimport { DesktopDownloadIcon, SearchIcon } from '@primer/octicons-react';\nimport {\n  Box,\n  ProgressBar,\n  Spinner,\n  ButtonPrimary,\n  Flash,\n  Button,\n} from '@primer/components';\nimport { useQuery } from 'react-query';\nimport {\n  BookConfig,\n  createPDFFromImages,\n  downloadFileFromBlob,\n  getBookImages,\n  getBookInfo,\n  getImageURL,\n} from './service';\nimport './DownloadForm.scss';\n\nfunction DownloadForm(): JSX.Element {\n  const [bookUrl, setBookUrl] = useState('');\n  const [error, setError] = useState(undefined);\n  const [progressState, setProgressState] = useState('init');\n  const [progress, setProgress] = useState(0);\n  const [bookInfo, setBookInfo] = useState(undefined as BookConfig | undefined);\n  const bookInfoQuery = useQuery<BookConfig, Error>(\n    ['book', 'info', bookUrl],\n    async () => getBookInfo(bookUrl),\n    {\n      enabled: false,\n      refetchOnWindowFocus: false,\n      refetchInterval: false,\n      retry: 1,\n      retryDelay: 0,\n      onSuccess: async (bookConfig) => {\n        setBookInfo(bookConfig);\n      },\n    },\n  );\n  const onClickBookInfo = async (evt: MouseEvent<HTMLButtonElement>) => {\n    evt.preventDefault();\n    setProgress(0);\n    setError(undefined);\n    await bookInfoQuery.refetch();\n  };\n\n  const onClickDownload = async (evt: MouseEvent<HTMLButtonElement>) => {\n    evt.preventDefault();\n    if (!bookInfo) {\n      return;\n    }\n    setError(undefined);\n    setProgress(0);\n    setProgressState('loading');\n    try {\n      const images = await getBookImages(bookInfo, (step) => {\n        setProgress(step * 0.8);\n      });\n      const pdf = await createPDFFromImages(images, (step) => {\n        const current = step * 0.2;\n        setProgress((prevState) => prevState + current);\n      });\n      const blob = new Blob([pdf], {\n        type: 'application/pdf',\n      });\n      downloadFileFromBlob(blob, bookInfo.title);\n      setProgressState('finish');\n    } catch (e) {\n      setError(e);\n    }\n  };\n\n  const onClickResetForm = (evt: MouseEvent<HTMLButtonElement>) => {\n    evt.preventDefault();\n    setBookUrl('');\n    setProgressState('init');\n    setProgress(0);\n    setBookInfo(undefined);\n    setError(undefined);\n  };\n  return (\n    <article className=\"Box-row\">\n      <label htmlFor=\"repository_description\">Book link</label>\n      <div className=\"input-group\">\n        <input\n          className=\"form-control\"\n          type=\"url\"\n          placeholder=\"https://www.myeschoolhome.com/mEBook.html?name=xxxxxx\"\n          value={bookUrl}\n          onChange={(e) => setBookUrl(e.target.value)}\n          aria-label=\"link\"\n        />\n        <span className=\"input-group-button\">\n          <button\n            className=\"btn btn-primary\"\n            type=\"button\"\n            aria-label=\"Copy to clipboard\"\n            disabled={bookInfoQuery.isLoading}\n            onClick={onClickBookInfo}\n          >\n            {!bookInfoQuery.isLoading ? (\n              <>\n                <SearchIcon /> <span className=\"text-light\"> Check</span>\n              </>\n            ) : (\n              <>\n                <Spinner size=\"small\" sx={{ verticalAlign: 'text-bottom' }} />{' '}\n                <span className=\"text-light\">\n                  Checking\n                  <span className=\"AnimatedEllipsis\" />\n                </span>\n              </>\n            )}\n          </button>\n        </span>\n      </div>\n      {(bookInfoQuery.isError || error) && (\n        <Flash my={3} variant=\"danger\">\n          {error || bookInfoQuery.error?.message}\n        </Flash>\n      )}\n      {bookInfo && (\n        <Box\n          borderWidth=\"1px\"\n          borderStyle=\"solid\"\n          borderColor=\"border.default\"\n          borderRadius={2}\n          bg=\"canvas.subtle\"\n          mt={3}\n          p={3}\n        >\n          <Box display=\"grid\" gridTemplateColumns=\"1fr 1fr\">\n            <Box\n              fontWeight=\"bold\"\n              borderColor=\"border.default\"\n              borderRightWidth={1}\n              borderRightStyle=\"solid\"\n              borderBottomWidth={1}\n              borderBottomStyle=\"solid\"\n              p={2}\n            >\n              Title\n            </Box>\n            <Box\n              borderColor=\"border.default\"\n              borderBottomWidth={1}\n              borderBottomStyle=\"solid\"\n              p={2}\n            >\n              {bookInfo?.title}\n            </Box>\n            <Box\n              fontWeight=\"bold\"\n              borderColor=\"border.default\"\n              borderRightWidth={1}\n              borderRightStyle=\"solid\"\n              borderBottomWidth={1}\n              borderBottomStyle=\"solid\"\n              p={2}\n            >\n              Cover page\n            </Box>\n            <Box\n              borderColor=\"border.default\"\n              borderBottomWidth={1}\n              borderBottomStyle=\"solid\"\n              p={2}\n            >\n              <img\n                alt=\"cover page\"\n                width=\"200\"\n                src={getImageURL(bookInfo)(bookInfo.startPage)}\n              />\n            </Box>\n            <Box\n              fontWeight=\"bold\"\n              borderColor=\"border.default\"\n              borderRightWidth={1}\n              borderRightStyle=\"solid\"\n              p={2}\n            >\n              Pages\n            </Box>\n            <Box p={2}>{bookInfo?.totalPageCount}</Box>\n          </Box>\n          <Box pt={3} textAlign=\"center\">\n            <ButtonPrimary onClick={onClickDownload}>\n              {progressState !== 'loading' ? (\n                <>\n                  <DesktopDownloadIcon /> Download\n                </>\n              ) : (\n                <>\n                  <Spinner size=\"small\" sx={{ verticalAlign: 'text-bottom' }} />{' '}\n                  <span className=\"text-light\">\n                    Generating pdf file\n                    <span className=\"AnimatedEllipsis\" />\n                  </span>\n                </>\n              )}\n            </ButtonPrimary>\n            <Button onClick={onClickResetForm} ml={3}>\n              Reset\n            </Button>\n          </Box>\n          {progressState !== 'init' && (\n            <Box pt={3}>\n              <ProgressBar\n                className=\"progress anim-grow-x\"\n                progress={progress}\n              />\n            </Box>\n          )}\n        </Box>\n      )}\n    </article>\n  );\n}\n\nexport default DownloadForm;\n","import React, { MouseEvent, useState } from 'react';\nimport { Box, Button, ButtonDanger, Dialog, Text } from '@primer/components';\nimport { TrashIcon, ZapIcon } from '@primer/octicons-react';\nimport { clearCache } from '../download-form/service';\n\nexport function ClearCache(): JSX.Element {\n  const [isOpen, setIsOpen] = useState(false);\n  const returnFocusRef = React.useRef(null);\n\n  const onClickClearCache = async (evt: MouseEvent<HTMLButtonElement>) => {\n    evt.preventDefault();\n    await clearCache();\n    window.location.reload();\n    setIsOpen(false);\n  };\n\n  return (\n    <>\n      <ButtonDanger ref={returnFocusRef} onClick={() => setIsOpen(true)}>\n        <TrashIcon /> Clear Cache\n      </ButtonDanger>\n      <Dialog\n        isOpen={isOpen}\n        returnFocusRef={returnFocusRef}\n        onDismiss={() => setIsOpen(false)}\n        aria-labelledby=\"label\"\n      >\n        <Dialog.Header>\n          <ZapIcon /> Attention\n        </Dialog.Header>\n        <Box p={3}>\n          <Text id=\"label\" fontFamily=\"sans-serif\">\n            Are you sure you&apos;d like to delete cached images?\n          </Text>\n          <Box display=\"flex\" mt={3} justifyContent=\"flex-end\">\n            <Button onClick={() => setIsOpen(false)} sx={{ mr: 1 }}>\n              Cancel\n            </Button>\n            <ButtonDanger onClick={onClickClearCache}>Delete</ButtonDanger>\n          </Box>\n        </Box>\n      </Dialog>\n    </>\n  );\n}\n","import React from 'react';\nimport { Box } from '@primer/components';\nimport DownloadForm from '../download-form/DownloadForm';\nimport { ClearCache } from './ClearCache';\n\nfunction Container(): JSX.Element {\n  return (\n    <div className=\"position-relative container-lg p-responsive pt-6\">\n      <Box>\n        <DownloadForm />\n      </Box>\n      <Box mt={5}>\n        <ClearCache />\n      </Box>\n    </div>\n  );\n}\n\nexport default Container;\n","import React from 'react';\n\nfunction Footer(): JSX.Element {\n  return (\n    <div className=\"footer container-lg width-full p-responsive\">\n      <div className=\"d-flex flex-justify-center pb-6\">\n        <span className=\"f6 color-fg-muted\" />\n      </div>\n    </div>\n  );\n}\n\nexport default Footer;\n","import React from 'react';\n\nfunction Header(): JSX.Element {\n  return (\n    <div className=\"color-bg-subtle border-bottom\">\n      <div className=\"container-lg p-responsive text-center py-6\">\n        <h1 className=\"h1\">Download Book</h1>\n        <p className=\"f4 color-fg-muted col-md-6 mx-auto\">\n          Version v{process.env.REACT_APP_VERSION}\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default Header;\n","import { BaseStyles, ThemeProvider } from '@primer/components';\nimport React from 'react';\nimport { Header, Container, Footer } from './components';\n\nfunction App(): JSX.Element {\n  return (\n    <ThemeProvider colorMode=\"auto\" dayScheme=\"light\" nightScheme=\"dark_dimmed\">\n      <BaseStyles>\n        <div className=\"application-main\">\n          <Header />\n          <Container />\n          <Footer />\n        </div>\n      </BaseStyles>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler): void => {\n  if (onPerfEntry && typeof onPerfEntry === 'function') {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { StrictMode } from 'react';\nimport { render } from 'react-dom';\nimport { QueryClient, QueryClientProvider } from 'react-query';\nimport { BrowserRouter } from 'react-router-dom';\nimport './index.scss';\nimport App from './app/App';\nimport reportWebVitals from './reportWebVitals';\nimport updateFavIcon from './updateFavIcon';\n\nconst queryClient = new QueryClient();\nrender(\n  <StrictMode>\n    <QueryClientProvider client={queryClient}>\n      <BrowserRouter>\n        <App />\n      </BrowserRouter>\n    </QueryClientProvider>\n  </StrictMode>,\n  document.getElementById('root'),\n);\n\nupdateFavIcon();\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","export default function updateFavIcon(): void {\n  const faviconTags = document.getElementsByClassName(\n    'js-site-favicon',\n  ) as HTMLCollectionOf<HTMLLinkElement>;\n  let lastCheck = false;\n\n  function changeFavIcon(isDark: boolean) {\n    if (lastCheck === isDark) {\n      return;\n    }\n    lastCheck = isDark;\n    const search = lastCheck ? 'favicon.' : 'favicon-dark.';\n    const replace = lastCheck ? 'favicon-dark.' : 'favicon.';\n    for (let i = 0; i < faviconTags.length; i++) {\n      faviconTags[i].href = faviconTags[i].href.replace(search, replace);\n    }\n  }\n\n  // first run\n  changeFavIcon(window.matchMedia('(prefers-color-scheme: dark)').matches);\n\n  // listen to events\n  window\n    .matchMedia('(prefers-color-scheme: dark)')\n    .addEventListener('change', (e) => changeFavIcon(e.matches));\n}\n"],"sourceRoot":""}