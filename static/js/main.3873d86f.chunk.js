(this["webpackJsonpimg-pdf"]=this["webpackJsonpimg-pdf"]||[]).push([[0],{125:function(e,t,r){},152:function(e,t,r){},160:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(53),c=r(45),i=r(112),s=(r(125),r(169)),l=r(171),u=r(59),d=r(18),h=r.n(d),b=r(23),p=r(24),f=r(39),j=r(163),m=r(164),x=r(165),v=r(166),O=r(167),g=r(62),w=r(48),y=r(88),k=r.n(y),C=r(89),N="images";function B(e){return S.apply(this,arguments)}function S(){return(S=Object(b.a)(h.a.mark((function e(t){var r,n,a,o,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new URL(t.trim()),n=["/eBook.html","/mEBook.html"].map((function(e){return e.toLowerCase()})),["www.myeschoolhome.com","myeschoolhome.com"].map((function(e){return e.toLowerCase()})).includes(r.host.toLowerCase())&&n.includes(r.pathname.toLowerCase())){e.next=5;break}throw new Error("Not supported book url");case 5:if(a=r.searchParams.get("name")){e.next=8;break}throw new Error("Missing book name");case 8:return e.next=10,k.a.post("https://cors.ali-yusuf.com/",{ebookNewName:a,userId:null},{headers:{"Content-Type":"application/json; charset=UTF-8",Authorization:"Bearer null"},params:{url:"https://www.myeschoolhome.com/library/webservice/ebooks/getEbookConfig"}});case 10:o=e.sent,e.prev=11,c=JSON.parse(o.data.bookConfig),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(11),new Error("Can't parse response data.");case 18:return e.abrupt("return",Object(w.a)(Object(w.a)({},c),{},{URL:r}));case 19:case"end":return e.stop()}}),e,null,[[11,15]])})))).apply(this,arguments)}function E(e){return function(t){return"https://cors.ali-yusuf.com/?url=".concat(e.URL.origin).concat(e.largePath).concat(t,".jpg")}}function P(e,t){return R.apply(this,arguments)}function R(){return(R=Object(b.a)(h.a.mark((function e(t,r){var n,a,o,c,i,s,l;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=0,2,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return n+=e||1,Math.floor(n/2)},o=E(t),c=[],i=t.startPage;i<=t.totalPageCount;i++)c.push(o(i));if(s=[],!("caches"in window)){e.next=12;break}return e.next=10,caches.open(N).then(function(){var e=Object(b.a)(h.a.mark((function e(t){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addAll(c);case 2:null===r||void 0===r||r(a(c.length)),n=c.map((function(e,n){return t.match(e).then((function(t){if(!t)throw new Error("Missing image, Url: ".concat(e));return null===r||void 0===r||r(a()),new Promise((function(e,r){t.arrayBuffer().then((function(t){e({data:t,sort:n})})).catch(r)}))}))})),s.push.apply(s,Object(g.a)(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:e.next=14;break;case 12:l=c.map((function(e,t){return new Promise((function(n,o){var c=document.createElement("canvas"),i=new Image;i.src=e,i.onload=function(){null===r||void 0===r||r(a()),c.width=i.naturalWidth,c.height=i.naturalHeight;var s=c.getContext("2d");null===s||void 0===s||s.drawImage(i,0,0),c.toBlob((function(i){i?i.arrayBuffer().then((function(e){null===r||void 0===r||r(a()),n({data:e,sort:t})})).catch(o):o(new Error("Empty image blob, Url: ".concat(e))),c.remove()}),"image/jpeg")},i.crossOrigin="anonymous",i.onerror=function(e){c.remove(),o(e)}}))})),s.push.apply(s,Object(g.a)(l));case 14:return e.abrupt("return",Promise.all(s).then((function(e){return e.sort((function(e,t){return e.sort>t.sort?1:-1})).map((function(e){return e.data}))})));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return F.apply(this,arguments)}function F(){return(F=Object(b.a)(h.a.mark((function e(t,r){var n,a,o,c,i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,2,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return n+=e||1,Math.floor(n/2)},e.next=5,C.PDFDocument.create();case 5:return o=e.sent,c=t.map((function(e,t){return new Promise((function(r,n){o.embedJpg(e).then((function(e){r({data:e,sort:t})})).catch(n)}))})),e.next=9,Promise.all(c);case 9:return i=e.sent.sort((function(e,t){return e.sort>t.sort?1:-1})).map((function(e){return e.data})),null===r||void 0===r||r(a(i.length)),i.forEach((function(e){o.addPage([e.width,e.height]).drawImage(e,{x:0,y:0})})),null===r||void 0===r||r(a(i.length)),e.abrupt("return",o.save());case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){var r=URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),n.remove(),setTimeout((function(){URL.revokeObjectURL(r)}),0)}function D(){return A.apply(this,arguments)}function A(){return(A=Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("caches"in window)){e.next=3;break}return e.next=3,caches.delete(N);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}r(152);var U=r(5);var M=function(){var e,t=Object(n.useState)(""),r=Object(p.a)(t,2),a=r[0],o=r[1],i=Object(n.useState)(void 0),s=Object(p.a)(i,2),l=s[0],d=s[1],g=Object(n.useState)("init"),w=Object(p.a)(g,2),y=w[0],k=w[1],C=Object(n.useState)(0),N=Object(p.a)(C,2),S=N[0],R=N[1],F=Object(n.useState)(void 0),D=Object(p.a)(F,2),A=D[0],M=D[1],I=Object(c.useQuery)(["book","info",a],Object(b.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B(a));case 1:case"end":return e.stop()}}),e)}))),{enabled:!1,refetchOnWindowFocus:!1,refetchInterval:!1,retry:1,retryDelay:0,onSuccess:function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),T=function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),R(0),d(void 0),e.next=5,I.refetch();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(b.a)(h.a.mark((function e(t){var r,n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),A){e.next=3;break}return e.abrupt("return");case 3:return d(void 0),R(0),k("loading"),e.prev=6,e.next=9,P(A,(function(e){R(.8*e)}));case 9:return r=e.sent,e.next=12,L(r,(function(e){var t=.2*e;R((function(e){return e+t}))}));case 12:n=e.sent,W(new Blob([n],{type:"application/pdf"}),A.title),k("finish"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),d(e.t0);case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)("article",{className:"Box-row",children:[Object(U.jsx)("label",{htmlFor:"repository_description",children:"Book link"}),Object(U.jsxs)("div",{className:"input-group",children:[Object(U.jsx)("input",{className:"form-control",type:"url",placeholder:"https://www.myeschoolhome.com/mEBook.html?name=xxxxxx",value:a,onChange:function(e){return o(e.target.value)},"aria-label":"link"}),Object(U.jsx)("span",{className:"input-group-button",children:Object(U.jsx)("button",{className:"btn btn-primary",type:"button","aria-label":"Copy to clipboard",disabled:I.isLoading,onClick:T,children:I.isLoading?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(j.a,{size:"small",sx:{verticalAlign:"text-bottom"}})," ",Object(U.jsxs)("span",{className:"text-light",children:["Checking",Object(U.jsx)("span",{className:"AnimatedEllipsis"})]})]}):Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(f.b,{})," ",Object(U.jsx)("span",{className:"text-light",children:" Check"})]})})})]}),(I.isError||l)&&Object(U.jsx)(m.a,{my:3,variant:"danger",children:l||(null===(e=I.error)||void 0===e?void 0:e.message)}),A&&Object(U.jsxs)(u.a,{borderWidth:"1px",borderStyle:"solid",borderColor:"border.default",borderRadius:2,bg:"canvas.subtle",mt:3,p:3,children:[Object(U.jsxs)(u.a,{display:"grid",gridTemplateColumns:"1fr 1fr",children:[Object(U.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:"Title"}),Object(U.jsx)(u.a,{borderColor:"border.default",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:null===A||void 0===A?void 0:A.title}),Object(U.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:"Cover page"}),Object(U.jsx)(u.a,{borderColor:"border.default",borderBottomWidth:1,borderBottomStyle:"solid",p:2,children:Object(U.jsx)("img",{alt:"cover page",width:"200",src:E(A)(A.startPage)})}),Object(U.jsx)(u.a,{fontWeight:"bold",borderColor:"border.default",borderRightWidth:1,borderRightStyle:"solid",p:2,children:"Pages"}),Object(U.jsx)(u.a,{p:2,children:null===A||void 0===A?void 0:A.totalPageCount})]}),Object(U.jsxs)(u.a,{pt:3,textAlign:"center",children:[Object(U.jsx)(x.a,{onClick:J,children:"loading"!==y?Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(f.a,{})," Download"]}):Object(U.jsxs)(U.Fragment,{children:[Object(U.jsx)(j.a,{size:"small",sx:{verticalAlign:"text-bottom"}})," ",Object(U.jsxs)("span",{className:"text-light",children:["Generating pdf file",Object(U.jsx)("span",{className:"AnimatedEllipsis"})]})]})}),Object(U.jsx)(v.a,{onClick:function(e){e.preventDefault(),o(""),k("init"),R(0),M(void 0),d(void 0)},ml:3,children:"Reset"})]}),"init"!==y&&Object(U.jsx)(u.a,{pt:3,children:Object(U.jsx)(O.a,{className:"progress anim-grow-x",progress:S})})]})]})},I=r(168),T=r(170),J=r(109);function z(){var e=Object(n.useState)(!1),t=Object(p.a)(e,2),r=t[0],o=t[1],c=a.a.useRef(null),i=function(){var e=Object(b.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,D();case 3:window.location.reload(),o(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(U.jsxs)(U.Fragment,{children:[Object(U.jsxs)(I.a,{ref:c,onClick:function(){return o(!0)},children:[Object(U.jsx)(f.c,{})," Clear Cache"]}),Object(U.jsxs)(T.a,{isOpen:r,returnFocusRef:c,onDismiss:function(){return o(!1)},"aria-labelledby":"label",children:[Object(U.jsxs)(T.a.Header,{children:[Object(U.jsx)(f.d,{})," Attention"]}),Object(U.jsxs)(u.a,{p:3,children:[Object(U.jsx)(J.a,{id:"label",fontFamily:"sans-serif",children:"Are you sure you'd like to delete cached images?"}),Object(U.jsxs)(u.a,{display:"flex",mt:3,justifyContent:"flex-end",children:[Object(U.jsx)(v.a,{onClick:function(){return o(!1)},sx:{mr:1},children:"Cancel"}),Object(U.jsx)(I.a,{onClick:i,children:"Delete"})]})]})]})]})}var Q=function(){return Object(U.jsxs)("div",{className:"position-relative container-lg p-responsive pt-6",children:[Object(U.jsx)(u.a,{children:Object(U.jsx)(M,{})}),Object(U.jsx)(u.a,{mt:5,children:Object(U.jsx)(z,{})})]})};var H=function(){return Object(U.jsx)("div",{className:"footer container-lg width-full p-responsive",children:Object(U.jsx)("div",{className:"d-flex flex-justify-center pb-6",children:Object(U.jsx)("span",{className:"f6 color-fg-muted"})})})};var _=function(){return Object(U.jsx)("div",{className:"color-bg-subtle border-bottom",children:Object(U.jsxs)("div",{className:"container-lg p-responsive text-center py-6",children:[Object(U.jsx)("h1",{className:"h1",children:"Download Book"}),Object(U.jsxs)("p",{className:"f4 color-fg-muted col-md-6 mx-auto",children:["Version v","0.2.2"]})]})})};var G=function(){return Object(U.jsx)(s.a,{colorMode:"auto",dayScheme:"light",nightScheme:"dark_dimmed",children:Object(U.jsx)(l.a,{children:Object(U.jsxs)("div",{className:"application-main",children:[Object(U.jsx)(_,{}),Object(U.jsx)(Q,{}),Object(U.jsx)(H,{})]})})})},V=function(e){e&&"function"===typeof e&&r.e(3).then(r.bind(null,172)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;r(e),n(e),a(e),o(e),c(e)}))};var q=new c.QueryClient;Object(o.render)(Object(U.jsx)(n.StrictMode,{children:Object(U.jsx)(c.QueryClientProvider,{client:q,children:Object(U.jsx)(i.a,{children:Object(U.jsx)(G,{})})})}),document.getElementById("root")),function(){var e=document.getElementsByClassName("js-site-favicon"),t=!1;function r(r){if(t!==r)for(var n=(t=r)?"favicon.":"favicon-dark.",a=t?"favicon-dark.":"favicon.",o=0;o<e.length;o++)e[o].href=e[o].href.replace(n,a)}r(window.matchMedia("(prefers-color-scheme: dark)").matches),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){return r(e.matches)}))}(),V()}},[[160,1,2]]]);
//# sourceMappingURL=main.3873d86f.chunk.js.map